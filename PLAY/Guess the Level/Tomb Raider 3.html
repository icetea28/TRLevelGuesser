<!DOCTYPE html>
<html>
<head>
    <title>TOMB RAIDER LEVEL GUESSER (BETA)</title>
    <link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
    <h1>TOMB RAIDER LEVEL GUESSER</h1>
    <p class="version">Beta v0.2.1</p>
    <p class="credits">
        credits to gui for helping out with some TR3 pictures YEP
        <br>https://www.twitch.tv/guigui0001_
    </p>

    <button id="change-amount-button" class="change-amount-button" onclick="imageAmount()">Change number of pictures (10)</button>

    <h2>Rules and Information:</h2>
    <ul class="rules">
        <li>Enter the name of the level in the box next to each picture</li>
        <li>There's a margin of 2 spelling mistakes per answer (apostrophes like ' must not be forgotten though!)</li>
        <li>Capitalization is not considered</li>
        <li>You can reveal the solution for pictures you can't solve at the end</li>
        <li>If you're unsure about a level name, open levelnames.txt in the main folder to check for each exact name</li>
    </ul>


    <div id="riddles-container">
        <!-- Bilder und Eingabefelder dynamisch hinzugefÃ¼gt -->
    </div>

    <br>
    <button class="checkAnswers" onclick="checkAnswers()">Check your answers</button>
    <button class="fillWrongAnswers" onclick="fillWrongAnswers()">Fill wrong answers</button>

    <div id="result"></div>

    <script>
        /*

        var result = '';
for (let img of imageFileNames) {
  
     let imgName = img.substr('../../pictures/TR3/'.length);
     result += '"' + imgName + '": {';
     result += 'solution: "' + correctAnswers[img] + '",'
     result += 'hint: "' + getClueForImage(img) + '"'
     result += "},";
  
}
console.log(result)

        */

        const riddleData = {
            folder: '../../pictures/TR3/',

            images: {
                "tr3.aldwych.1d.png": { solution: "aldwych", hint: "a crystal can be found in this room" },
                "tr3.aldwych.37m.png": { solution: "aldwych", hint: "you need to pay here!" },
                "tr3.aldwych.55e.png": { solution: "aldwych", hint: "this is kind of a 'secret' location" },
                "tr3.antarc.29m.png": { solution: "antarctica", hint: "don't get poisoned here!" },
                "tr3.antarc.57m.png": { solution: "antarctica", hint: "this is a 'secret' entrance" },
                "tr3.antarc.93d.png": { solution: "antarctica", hint: "here you find an item you can use multiple times even though you need it only once" },
                "tr3.antarc.126e.png": { solution: "antarctica", hint: "you wouldn't be able to see anything if i wouldn't have removed the crystal in this picture" },
                "tr3.area51.18e.png": { solution: "area 51", hint: "surprisingly there are only humans in here" },
                "tr3.area51.96m.png": { solution: "area 51", hint: "when you can see this texture the doors in the picture should be open" },
                "tr3.cavern.5e.png": { solution: "meteorite cavern", hint: "don't cross this line or you may die!" },
                "tr3.cavern.12e.png": { solution: "meteorite cavern", hint: "you're at the highest point of the level!" },
                "tr3.cavern.27m.png": { solution: "meteorite cavern", hint: "don't stare at this window or you may get burned!" },
                "tr3.city.13e.png": { solution: "city", hint: "don't stare at this or you may get struck by lightnings!" },
                "tr3.coastal.121e.png": { solution: "coastal village", hint: "some nice unique red stones can be found in this area" },
                "tr3.crash.29m.png": { solution: "undefined", hint: "No clue available for this image. I must have forgotten it FeelsBadMan" },
                "tr3.crash.72e.png": { solution: "crash site", hint: "getting burned is your least concern - don't get eaten rather" },
                "tr3.ganges.58d.png": { solution: "the river ganges", hint: "don't run to the left or you may not see this place again" },
                "tr3.ganges.100d.png": { solution: "the river ganges", hint: "pick up a key here for the alternative route that you chose" },
                "tr3.hallows.21e.png": { solution: "all hallows", hint: "the end?" },
                "tr3.jungle.83e.png": { solution: "jungle", hint: "you can't see the water in the background yet" },
                "tr3.jungle.103d.png": { solution: "jungle", hint: "only if you actually play dev-intended here" },
                "tr3.kaliya.13e.png": { solution: "caves of kaliya", hint: "beware of boulders!" },
                "tr3.kaliya.17e.png": { solution: "caves of kaliya", hint: "not only this hallway feels like a maze" },
                "tr3.luds.35m.png": { solution: "lud's gate", hint: "a wide painting in a gigantic room" },
                "tr3.luds.37e.png": { solution: "lud's gate", hint: "there are 4 of those right as you enter, how can you not know this? monkaS" },
                "tr3.luds.74d.png": { solution: "lud's gate", hint: "time to breath!" },
                "tr3.madubu.53d.png": { solution: "madubu gorge", hint: "hidden behind a bridge" },
                "tr3.madubu.143e.png": { solution: "undefined", hint: "No clue available for this image. I must have forgotten it FeelsBadMan" },
                "tr3.nevada.113e.png": { solution: "nevada desert", hint: "apparently Lara didn't have her drivers licence as we find out a few minutes later" },
                "tr3.nevada.143e.png": { solution: "nevada desert", hint: "you lose everything here and you don't remember this place?" },
                "tr3.puna.0e.png": { solution: "temple of puna", hint: "your face expression the first time you died to the traps in this level" },
                "tr3.rx.163e.png": { solution: "rx-tech mines", hint: "make sure to avoid this drill!" },
                "tr3.rx.178d.png": { solution: "rx-tech mines", hint: "usually you drive past that place - or die right here" },
                "tr3.temple.48e.png": { solution: "temple ruins", hint: "all of this can be avoided with a simple jump at the start" },
                "tr3.temple.181e.png": { solution: "temple ruins", hint: "a kind of 'secret' place" },
                "tr3.thames.1e.png": { solution: "thames wharf", hint: "literally the highest point in this level" },
                "tr3.thames.13e.png": { solution: "thames wharf", hint: "finally back out of the underground" },
                "tr3.thames.130m.png": { solution: "thames wharf", hint: "just a block away from the never-ending depth" },
                "tr3.tinnos.15m.png": { solution: "lost city of tinnos", hint: "Uli is watching you here" },
                "tr3.tinnos.43d.png": { solution: "lost city of tinnos", hint: "the top of a large bridge" },
                "tr3.tinnos.67d.png": { solution: "lost city of tinnos", hint: "No clue available for this image. I must have forgotten it FeelsBadMan" },
                "tr3.tinnos.101e.png": { solution: "lost city of tinnos", hint: "let the fight begin!" },
                "tr3.coastal.188.18m.png": { solution: "coastal village", hint: "same area used twice, but is it the end of the first or the start of the second level?" },
                "tr3.hallowsd.png": { solution: "all hallows", hint: "you entered here at the top, how did you miss that cross?" },
                "tr3.hsc.49.46d.png": { solution: "high security compound", hint: "open the doors to your mates and they might help you with this" },
                "tr3.ludsm.png": { solution: "lud's gate", hint: "watch your step, it's a long drop" },
                "tr3.antarc.51m.png": { solution: "antarctica", hint: "No clue available for this image. I must have forgotten it FeelsBadMan" },
                "tr3.area51.31m.png": { solution: "area 51", hint: "Lara enjoyed the can" },
                "tr3.cavern.27d.png": { solution: "meteorite cavern", hint: "Lara has all the artifacts in her backpack" },
                "tr3.tinnos.0m.png": { solution: "lost city of tinnos", hint: "Could be the 5th mask" },
                "tr3.hsc.78d.png": { solution: "high security compound", hint: "Lara can't reach this room" },
                "tr3.crash.65m.png": { solution: "crash site", hint: "Beware the piranhas" },
                "tr3.rx.146m.png": { solution: "rx-tech mines", hint: "don't slide forwards" },
                "tr3.city.19d.png": { solution: "city", hint: "There's electricity in the air here!" },
                "tr3.ganges.26d.png": { solution: "the river ganges", hint: "I won't tell you, it's a secret!" },
                "tr3.madubu.6m.png": { solution: "madubu gorge", hint: "Looks like coastal village, eg? But it's not!" },
                "tr3.thames.5e.png": { solution: "thames wharf", hint: "Danger is above all when there is no water" },
                "tr3.aldwych.63m.png": { solution: "aldwych", hint: "This is a transport plan" },
                "tr3.coastal.186e.png": { solution: "coastal village", hint: "A dangerous corridor" },
                "tr3.hallows.25d.png": { solution: "all hallows", hint: "The very last room" },
                "tr3.temple.200e.png": { solution: "temple ruins", hint: "Block pushing is required here" },
                "tr3.kaliya.7m.png": { solution: "saves of kaliya", hint: "Boulder is probably not the worst threat here" },
                "tr3.luds.154m.png": { solution: "lud's gate", hint: "Roasted" },
                "tr3.puna.13m.png": { solution: "temple of puna", hint: "There's a lot of deagle ammo here!" }
            }
        };

        // Add the key of each image as source to the entry so the entries by themselves are fully defined
        for (let key of Object.keys(riddleData.images)) {
            riddleData.images[key].source = key;
        }

        
        function checkAnswers() {
            // Clear the wrongAnswers object before checking answers
            wrongAnswers = {};

            let totalCorrect = 0;

            const riddles = document.getElementsByClassName("riddle");
            for (let i = 0; i < riddles.length; i++) {
                const image = riddles[i].querySelector("img");
                const input = riddles[i].querySelector("input");
                const imageName = image.getAttribute("src").split('/').pop();
                let playerAnswer = input.value.toLowerCase();

                // Remove the 'correct-answer' and 'wrong-answer' classes to reset colors
                input.classList.remove("correct-answer");
                input.classList.remove("wrong-answer");

                // If input is not empty or just spaces
                if (playerAnswer.trim() === "") {
                    playerAnswer = "Blank";
                }

                if (riddleData.images[imageName]) {
                    const correctAnswer = riddleData.images[imageName].solution;

                    // check for mistake
                    if (isCloseEnough(playerAnswer, correctAnswer)) {
                        totalCorrect++;
                        input.classList.add("correct-answer"); // Add 'correct-answer' class
                    } else {
                        wrongAnswers[playerAnswer] = correctAnswer;
                        input.classList.add("wrong-answer"); // Add 'wrong-answer' class
                    }
                }
            }

            // TODO: Styling
            let resultMessage = "<font size=5><b><font color=#01DF01>Total correct answers: " + totalCorrect + "/" + riddles.length + "</font></b></font>";
            if (Object.keys(wrongAnswers).length > 0) {
                resultMessage += "<p></p><br><font size=5><b><font color=#FF0000>Your mistakes:</font></b></font>";
                for (let playerAnswer in wrongAnswers) {
                    resultMessage += "<br>" + playerAnswer;
                }
            }

            document.getElementById("result").innerHTML = resultMessage;
        }

        function selectRiddleEntries(totalEntries) {
            const randomImageKeys = Object.keys(riddleData.images).sort(() => 0.5 - Math.random());
            const randomImages = [];

            for (let i = 0; i < totalEntries; ++i) {
                randomImages.push(riddleData.images[randomImageKeys[i]]);
            }
            return randomImages;
        }

        function addImagesToPage(imageEntries) {
            const riddlesContainer = document.getElementById('riddles-container');
            riddlesContainer.innerHTML = '';

            for (const imageEntry of imageEntries) {
                const riddleDiv = document.createElement('div');
                riddleDiv.classList.add('riddle');

                const imageElem = document.createElement('img');
                imageElem.src = riddleData.folder + imageEntry.source;
                imageElem.alt = 'Riddle picture';

                const inputElem = document.createElement('input');
                inputElem.type = 'text';
                inputElem.style = 'width: 300px; height: 40px';
                inputElem.placeholder = 'Enter level name';

                const clueButton = document.createElement('button');
                clueButton.textContent = 'Get a clue';
                clueButton.classList.add('clue-button');
                clueButton.addEventListener('click', () => alert(imageEntry.hint));

                riddleDiv.appendChild(imageElem);
                riddleDiv.appendChild(inputElem);
                riddleDiv.appendChild(clueButton);


                riddlesContainer.appendChild(riddleDiv);
                riddlesContainer.appendChild(document.createElement("br"));
            }
        }

        function updateButtonText(numberOfImages) {
            const button = document.getElementById('change-amount-button');
            button.textContent = 'Change number of pictures (' + numberOfImages + ')';
        }

        function fillWrongAnswers() {
            const riddles = document.getElementsByClassName("riddle");
            for (let i = 0; i < riddles.length; i++) {
                const input = riddles[i].querySelector("input");
                const playerAnswer = input.value.toLowerCase();

                if (playerAnswer in wrongAnswers) {
                    input.value = wrongAnswers[playerAnswer];
                    input.classList.remove("wrong-answer"); // Entferne die CSS-Klasse
                } else {
                    input.classList.remove("correct-answer"); // Entferne die CSS-Klasse
                }
            }
        }

        // check if there's a mistake and how close it has to be
        function isCloseEnough(str1, str2) {
            const maxErrors = 2; // amount of max possible mistakes
            let errors = 0;

            for (let i = 0; i < Math.min(str1.length, str2.length); i++) {
                if (str1[i] !== str2[i]) {
                    errors++;
                    if (errors > maxErrors) {
                        return false;
                    }
                }
            }

            // in case of different length of strings
            errors += Math.abs(str1.length - str2.length);

            return errors <= maxErrors;
        }

        function imageAmount() {
            let newNumberOfImages = parseInt(prompt('Enter the number of images you want to guess (up to 10):'));
            if (newNumberOfImages === false) {
                return;
            } else if (isNaN(newNumberOfImages) || newNumberOfImages <= 0 || newNumberOfImages > 10) {
                alert('Please enter a valid number between 1 and 10.');
                return;
            }

            updateButtonText(newNumberOfImages);
            const newImages = selectRiddleEntries(newNumberOfImages);
            addImagesToPage(newImages);
        }

        addImagesToPage(selectRiddleEntries(10));
        var wrongAnswers = {}; // declare outside functions

    </script>
</body>
</html>
